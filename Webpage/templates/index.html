<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <title>Image Collection</title>
</head>
<body>
    <div class="json-container" style="margin-top: 5vh;">
        <table id="imageTable" class="json-table table" style="width: 95%; margin-left: 2.5%;">
            <thead>
                <tr>
                    <th scope="col">Image</th>
                    <th scope="col">Timestamp</th>
                    <th scope="col">Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Images will be dynamically inserted here by JavaScript -->
            </tbody>
        </table>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        function fetchImages() {
            $.ajax({
                url: '/get_images',  // Route to fetch image data from the server
                type: 'POST',  // Use POST request
                success: function(response) {
                    updateImageTable(response);
                    console.log('response is:', response);
                },
                error: function(error) {
                    console.log('Error fetching image data:', error);
                }
            });
        }

        function updateImageTable(data) {
            var tableBody = $('#imageTable tbody');
            tableBody.empty();  // Clear the table body before updating
            
            if (data.length > 0) {
                var latestImage = data[0]; // Only get the first image
                var row = $('<tr></tr>');

                // Add the image column with the image URL
                var imageCell = $('<td></td>');
                var image = $('<img>').attr('src', latestImage["url"]).attr('alt', 'Sensor Image').css('max-width', '150px');
                imageCell.append(image);
                row.append(imageCell);

                // Add the timestamp column
                row.append($('<td></td>').text(latestImage["timestamp"]));

                // Add the remove button
                var removeCell = $('<td></td>');
                var removeForm = $('<form method="POST" action="/remove_sensor"></form>');
                var input = $('<input type="hidden" name="sensor_id" value="' + latestImage["system_id"] + '">');
                var button = $('<button type="submit" class="btn btn-danger">Remove</button>');
                
                removeForm.append(input);
                removeForm.append(button);
                removeCell.append(removeForm);
                row.append(removeCell);

                // Append the row to the table body
                tableBody.append(row);
            }
        }

        // Fetch image data initially and then refresh every 5 seconds
        fetchImages();
        setInterval(fetchImages, 2000);  // 5000 milliseconds = 5 seconds
    </script>
</body>
</html>
